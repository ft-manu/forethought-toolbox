const fs = require('fs');
const path = require('path');

// Org list: [org_id, display_name]
const orgs = [
  [1459, 'granicus'], [1458, 'payscale'], [1457, 'stubhub'], [1456, 'gainsight'], [1455, 'ncontracts sandbox'], [1454, 'bk8'], [1453, 'perlman'], [1452, 'credit-genie-sbox'], [1451, 'fwrbrands'], [1450, 'Infoblox'], [1449, 'nuvocargo'], [1448, 'confluent'], [1447, 'Point of Rental'], [1446, 'YES Network'], [1445, 'Grid'], [1444, 'outsourceddoers'], [1443, 'PlanetDDS'], [1442, 'Acquia'], [1441, 'tapcheck-sanbox'], [1440, 'aura'], [1438, 'opengov'], [1437, 'CentralSquare'], [1436, 'inkind'], [1435, 'netflix'], [1434, 'GoCardless'], [1433, 'qualia'], [1432, 'ActiveCampaign - sandbox'], [1431, 'unanet'], [1430, 'TRG Screen'], [1429, 'Formstack Sandbox'], [1428, 'Insightsoftware Sandbox'], [1427, 'nourish'], [1426, 'renaissance-full-sandbox'], [1425, 'greenwayhealth'], [1424, 'constrafor'], [1422, 'firstbase'], [1421, 'sovos'], [1420, 'lodgify'], [1419, 'assent'], [1418, 'xref'], [1417, 'evvy'], [1415, 'qualtrics-internal'], [1414, 'airalo'], [1413, 'pawp'], [1412, 'circle'], [1411, 'Qualtrics'], [1410, 'vsco'], [1409, 'nextdoor'], [1408, 'ISW-test'], [1407, 'unleash'], [1406, 'wills-org'], [1405, 'revalize'], [1404, 'trackforce'], [1403, 'Headway-sandbox'], [1402, 'netgear'], [1401, 'ian-test'], [1400, 'evergreen-wealth-sandbox'], [1398, 'Test 123'], [1397, 'redgate'], [1396, 'BYD'], [1394, 'agentic-assist-sf-test'], [1393, 'sage-halocrm'], [1392, "Manu's Org"], [1391, 'tuition'], [1390, 'inflowinventory'], [1389, 'Maven Clinic'], [1388, 'agentic-assist-sami'], [1387, 'agentic-assist-test'], [1386, 'Homestory'], [1385, 'teemazing'], [1384, 'agent-assist-bug-bash'], [1383, 'credit-genie'], [1382, 'tala'], [1381, 'taimi'], [1380, 'iHealth'], [1378, 'wellesterhealth'], [1377, 'Distilled - DoneDeal Test'], [1376, 'foundation'], [1375, 'Avalara'], [1374, 'nicole-org'], [1373, 'onboarding'], [1372, 'Weitian Voice Test 2'], [1371, 'Weitian Voice Test'], [1370, 'runway'], [1369, 'retail-me-not'], [1368, 'Forethought Internal Slack'], [1366, 'jtl'], [1365, 'Team BIG'], [1364, 'Havenly Sandbox'], [1363, 'G2 Sandbox'], [1362, 'Test org 222aa'], [1361, 'Test org 111a<h1>a'], [1360, 'mealticket'], [1359, 'agentic-assist'], [1358, 'hummingbirds'], [1357, 'gszeto-test-1'], [1356, 'paylocity'], [1355, 'ncontracts'], [1354, 'tapcheck'], [1353, 'litera'], [1352, 'Cohere'], [1351, 'fixdapp'], [1350, 'bsasoftware'], [1347, 'Passport Global'], [1346, 'ethena'], [1344, 'Billtrust Sandbox'], [1343, 'Intercom se2'], [1342, 'meundies'], [1340, 'consensys'], [1338, 'macmillan'], [1337, 'thumbtack-trial'], [1336, 'orderbird'], [1335, 'evcs'], [1333, 'Calibrate-Sandbox'], [1332, 'arcoro'], [1331, 'Wallee'], [1330, 'Glencoco'], [1328, 'google-review-app1'], [1327, 'Lever Sandbox'], [1326, 'hatch-sandbox'], [1325, 'TSETrainingExample'], [1324, 'mercuryo'], [1323, 'Maven Sandbox'], [1322, 'tse-mock-12'], [1319, 'G2'], [1316, 'Weitian Test 6'], [1315, 'Front Elevate Demo'], [1314, 'Horatio Elevate Demo'], [1313, 'TuneCore Elevate Demo'], [1312, 'Elastic Elevate Demo'], [1311, 'PagerDuty Elevate Demo'], [1310, 'Capsule Elevate Demo'], [1309, 'Canopy and Stars Elevate Demo'], [1308, 'Buffer Elevate Demo'], [1307, 'Balsamiq Elevate Demo'], [1306, 'Artfinder'], [1305, 'Argus Elevate Demo'], [1304, 'Archways Elevate Demo'], [1303, 'AppFollow Elevate Demo'], [1302, 'AllThingsCX Elevate Demo'], [1301, 'ACJB Consulting Elevate Demo'], [1300, 'Abcam Elevate Demo'], [1299, 'Tailscale Elevate Demo 3'], [1298, 'Tailscale Elevate Demo 2'], [1297, 'Tailscale (Elevate Demo)'], [1296, 'MediShout (Elevate Test)'], [1295, 'TuneCoreTest'], [1294, 'Maxio'], [1293, 'formstack'], [1292, 'Lucanet'], [1291, 'Heimdal'], [1290, 'uniswap'], [1289, 'carerev'], [1288, 'insightsoftware'], [1286, 'thirdlove'], [1284, 'AlayaCare'], [1283, 'FuboTV'], [1282, 'recraft'], [1281, 'Oura'], [1280, 'd3vmax2'], [1279, 'Tebra Production'], [1278, 'Truework'], [1276, 'Clair'], [1275, 'Wisetack'], [1274, 'forethought.ai'], [1273, 'momentus'], [1272, 'cloaked'], [1271, 'Carta Sandbox'], [1270, 'YNAB Sandbox'], [1269, 'test'], [1268, 'havenly'], [1267, 'Alyce'], [1266, 'Omneky'], [1265, 'rollbar'], [1264, 'CyberpowerPC'], [1263, 'Predibase'], [1261, 'Billtrust'], [1260, 'Stake'], [1259, 'AA SFDC Messaging'], [1256, 'Duetto Sandbox'], [1255, 'onecause-sandbox'], [1254, 'lmn'], [1253, 'CSM Training'], [1252, 'CSM Training Fake'], [1247, 'Greenhouse'], [1245, 'Automattic'], [1244, '360Learning'], [1243, 'Datadog Sandbox'], [1239, 'Assist ZD Messaging'], [1238, 'HHAeXchange'], [1237, 'private-ai'], [1236, 'player-zero'], [1234, 'BeginHealth'], [1232, 'neon'], [1231, 'Peek'], [1229, 'Mitratech Sandbox'], [1228, 'renaissance-fd'], [1227, 'Carta'], [1226, 'Bright SG Ltd'], [1225, 'test-zd-messaging'], [1224, 'Wag Sandbox'], [1223, 'aarons-test'], [1222, 'CashWise'], [1220, 'grammarly'], [1219, 'babylist'], [1218, 'Weitian Test 4'], [1217, 'Weitian Test 3'], [1215, 'Weitian Test 5'], [1213, 'Weitian Test 2'], [1212, 'Corsair Sandbox'], [1211, 'Lara-org'], [1210, 'grants-org1'], [1209, 'Equisoft'], [1208, 'Weitian Test'], [1206, 'Deon Sandbox'], [1205, 'solve-freshchat'], [1203, 'Haven'], [1200, 'kroo-sandbox'], [1199, 'Greenhouse Sandbox'], [1198, 'Shitij- Test'], [1197, 'Sage'], [1195, 'Perks at Work'], [1194, 'grants-org'], [1193, 'Paramount'], [1192, 'styleseat-demo'], [1190, 'FDE-jira'], [1189, 'personify'], [1188, 'Tebra-Sandbox'], [1187, 'iFIT-uk'], [1186, 'navitas'], [1185, 'FDE-kustomer'], [1184, 'HealthEngine'], [1183, 'Calibrate'], [1182, 'evergreen-wealth'], [1181, 'wrike'], [1180, 'fiverr'], [1179, 'SpeedX'], [1178, 'mentorcliq'], [1177, 'finaldraft'], [1176, 'smalls'], [1175, 'Lose It'], [1174, 'imprint'], [1173, 'gszeto-test'], [1172, 'test-org-test'], [1171, 'duettoresearch'], [1170, 'codesignal'], [1169, 'fetch'], [1168, 'Proper Cloth'], [1167, 'reviewwave'], [1165, 'Harri'], [1163, 'pendo'], [1162, 'hipcamp'], [1160, 'onecause'], [1159, 'QSC Sandbox'], [1158, 'influenster'], [1157, 'Deel'], [1155, 'Deel'], [1153, 'Deel'], [1151, 'Deel'], [1149, 'Deel'], [1147, 'brendan-test-1'], [1146, 'squire-sandbox'], [1145, 'Deel'], [1143, 'Deel'], [1141, 'YNAB'], [1140, 'scaleai'], [1139, 'ActiveCampaign'], [1138, 'Qover'], [1136, 'renaissance-sf-sandbox'], [1135, 'dbt Labs'], [1134, 'thrizer'], [1133, 'Keller Postman'], [1132, 'qoria-qustodio'], [1131, 'Vivli-Prod'], [1129, 'GoCanvas'], [1128, 'SiteDocs'], [1125, 'icims-sandbox'], [1123, 'Leadpages'], [1122, 'Lime Sandbox'], [1120, "Sam's Test Org"], [1117, 'elementor-sandbox'], [1116, 'wag'], [1114, 'Movano'], [1113, 'HiHello, Inc.'], [1112, 'talkspace'], [1110, 'Pendulum'], [1108, 'qoria'], [1107, 'Bitsight Sandbox'], [1106, 'Triage LLM Playground'], [1105, 'test-contact-support'], [1104, 'NexTech'], [1103, 'Cloudbeds Streaming Demo'], [1101, 'addigy'], [1100, 'form'], [1099, 'testgorilla'], [1097, 'solawave'], [1096, 'Company'], [1095, 'Company'], [1094, 'WP Engine Sandbox'], [1093, 'Whatnot'], [1091, 'corsair'], [1090, 'tailscale'], [1089, 'Ridge'], [1088, 'testgordo'], [1087, 'Mailgun Deliverability Ninja (Test)'], [1086, 'notion-sandbox'], [1085, 'Juniper Networks DEON TEST'], [1084, 'ShipperHQ'], [1082, 'SmugMug'], [1081, 'oktaappreview'], [1080, 'Forethought fake company'], [1079, 'airtable-sandbox'], [1078, 'crunchtime'], [1077, 'peerspace'], [1075, 'WP Engine'], [1074, 'Jaggaer'], [1069, 'Evegeny E2E'], [1068, 'josephine-test'], [1067, 'andres-email-SF'], [1064, 'charlie-solve-email-sf'], [1063, 'Zach Test SF Email'], [1062, 'Airtable'], [1061, 'yext'], [1060, 'QSYS Sandbox'], [1059, 'hatch'], [1058, 'whatnot'], [1057, 'Engagement Management'], [1056, 'icims-test-org'], [1054, 'flickr'], [1053, 'Mosaic'], [1052, 'descript'], [1051, 'Fakecomp'], [1049, 'skyview'], [1048, 'Renaissance-US'], [1047, 'phrase'], [1046, 'Kroo'], [1044, 'Spring Meadow'], [1043, 'BirdyGrey'], [1042, 'BitSight'], [1040, 'tanner-zd-demo'], [1038, 'forethought'], [1034, 'Rula'], [1033, 'ethoslife-partnerships'], [1032, 'HiBob'], [1031, 'ft'], [1030, 'elementor'], [1029, 'Board'], [1027, 'test-8llh'], [1024, 'Test Org-2A5x'], [1021, 'Ruggable'], [1019, 'google-2z5U'], [1014, 'google-DTLl'], [1013, 'google'], [1011, 'quorum'], [1009, 'testjad'], [1005, 'solve-lite-test-2'], [1004, 'Deel Test Oct 18'], [1003, 'tanner_test'], [1002, 'roger_sf_test'], [1001, 'Gaille Test'], [999, 'ZALORA Indonesia'], [998, 'ZALORA Phillipines'], [996, 'Sinch'], [995, 'Cloudbeds - Historic Data'], [994, 'AWeber'], [985, 'Deel'], [983, 'rowens-pick-and-shovel'], [982, 'wonder-sandbox'], [981, 'lattice'], [979, 'bexio'], [978, 'charlie test'], [977, 'logicmonitor'], [976, 'QAD-Stage'], [975, 'magoosh'], [974, 'PayMaven'], [973, 'FrogSaladEaters'], [972, 'cratejoy-sandbox'], [971, 'asdfasdfa'], [970, 'zoominfo-sandbox'], [967, 'acme corp'], [965, 'Lion Brand Yarn'], [963, 'Scadriel'], [962, 'FDE-slingshot'], [961, 'jamestest'], [958, 'Deel Human Resources'], [956, 'Safesend'], [953, 'icims'], [952, 'ColumnTax'], [951, 'SpotOn'], [949, 'daxko'], [946, 'Lattice Sandbox'], [944, 'Cloudbeds'], [943, 'QAD'], [942, 'test-onboarding'], [940, 'Klipi'], [932, 'gailles-org'], [931, 'Flexport Demo'], [929, 'sage-sandbox'], [925, 'Deel HR'], [924, 'Zendesk Test Demo 3'], [923, 'Deel HR'], [920, 'zendesk demo test 1'], [919, 'brendan-test-handoff'], [918, 'Paymint'], [917, 'onboard-handoff-test-2'], [916, 'onboard-handoff-test-1'], [915, 'Gusto Integration Test 2'], [914, 'Gather'], [913, 'SmartShop'], [911, 'Zach-Test-Email'], [909, 'CoreSolveLite'], [905, 'Celtra'], [903, 'Gusto Integration Test'], [896, 'ft-notion-test'], [895, 'salesloft-sandbox'], [894, 'ak-test'], [893, 'SuperSonic'], [891, 'Yazio'], [889, 'salesforce-assist-demo'], [888, 'autonomous-agent-demo'], [887, 'intiveo'], [886, 'roadie-sf-sandbox'], [885, 'solve-lite-demo-sam-1'], [884, 'roadie-sf'], [882, 'Gusto Test'], [881, 'widget revamp demo'], [880, 'deel'], [879, 'ethoslife'], [878, 'Headway'], [877, 'CloudCorp'], [876, 'Pallium'], [875, 'ZALORA'], [872, 'Old CashWise'], [871, 'ShopZone'], [869, 'Jobvite'], [867, 'Forma'], [865, 'rippling-demo'], [864, 'Rippling'], [857, 'squire'], [856, 'Workable'], [850, 'treez'], [847, 'Solve UI E2E Test Org (Zendesk)'], [845, 'freshdesk-custom'], [839, "Macy's"], [838, "Macy's"], [837, "Macy's"], [835, 'noom-demo'], [829, 'Solve Lite Demo'], [824, 'jamie-test'], [823, 'brendan'], [822, 'd3v-zach'], [821, 'Flowspace Production'], [818, 'solve-lite-test'], [815, 'justworks-sandbox'], [810, 'Flowspace Salesforce'], [809, 'cv2-rollout-test'], [808, 'cv2-rollout-control'], [805, 'Navigate360'], [802, 'JJo'], [799, 'popmenu'], [790, 'ParadeDeck'], [784, 'fetch-sandbox'], [782, 'viome'], [781, 'forethought-for-you'], [780, 'd3v-murt'], [774, 'weitian_test'], [773, 'noom-testing'], [769, 'Mehaylaz-Potatoes'], [767, 'MHCCC-sandbox'], [766, 'FDE'], [765, 'clearcompany'], [760, 'Carfax Sandbox'], [759, 'Carfax'], [757, 'notion'], [755, 'eng-ops-analytics'], [754, 'forethought-ios-android-sdk'], [752, 'salesloft--dev'], [750, 'scribd'], [748, 'Brondell'], [747, 'Forethought'], [745, 'vgs-sandbox'], [744, 'act-on'], [743, 'act-on-trial'], [740, 'denise-test'], [737, 'stark-bank-sf'], [731, 'scribd-demo'], [730, 'blackthorn-sandbox'], [729, 'forethought-intercom-oauth'], [728, 'trilogy'], [727, 'cotopaxi'], [723, 'testsalina'], [722, 'scribd-sandbox'], [719, 'stark-shop-sf'], [713, 'KOHO'], [712, 'Medecins Sans Frontieres'], [710, 'test-sunco-shef'], [705, 'stark-shop-kustomer'], [704, 'stark-shop-intercom'], [703, 'stark-ai-intercom'], [702, 'stark-bank-intercom'], [698, 'forethought-sales'], [695, 'forethought-for-good'], [694, 'stark-tech-intercom'], [693, 'Code.Org'], [691, 'Mitsubishi-HCC'], [689, 'Blackthorn'], [688, 'kickfin-develoco-sandbox'], [687, 'kickfin-partial-sandbox'], [686, 'noom-growth'], [685, 'forethought-intercom-demo'], [682, 'servicenow-demo'], [680, 'forethought-intercom'], [678, 'Achievers-sandbox'], [673, 'Koho Test'], [671, 'Airbase'], [670, 'triage-test-234'], [668, 'kickfin'], [667, 'Achievers'], [665, 'Solve-bot'], [654, 'Generic Helpdesk Demo'], [650, 'latam-demo'], [647, 'helloheart'], [645, 'iPro'], [644, 'triage-discover-test'], [640, 'forethought-training'], [637, 'sesame'], [630, 'YenFlameThrower'], [626, 'clickup-sandbox'], [621, 'upwork1607994371'], [620, 'spordle'], [618, 'ie-mock-1'], [617, 'zach-sunco-demo'], [616, 'bigcommerce'], [615, 'clickup'], [614, 'cindy-zendesk-demo'], [613, ' Noom Support'], [609, "RVW's Sandbox"], [595, 'YenDemoOrg'], [594, 'session'], [585, 'bigcommerce-sandbox'], [583, 'Vivino-sandbox'], [381, 'gusto-site-search2'], [299, 'ZD_CUST']
];

const inputPath = path.join(__dirname, 'bookmarks_fixed_cleaned.json');
const outputPath = path.join(__dirname, 'bookmarks_fixed_enhanced.json');
const raw = fs.readFileSync(inputPath, 'utf8');
const data = JSON.parse(raw);
const bookmarksArr = data.bookmarks || [];

const enhancedArr = [...bookmarksArr];
const dashboardGroups = {};

// Group by dashboard URL pattern (ignoring org_id)
enhancedArr.forEach(bm => {
  if (
    (!bm.categoryId || bm.categoryId === null) &&
    (!bm.tags || bm.tags.length === 0) &&
    typeof bm.url === 'string' &&
    bm.url.includes('dashboard-int.forethought.tech/discover/dashboard?org=')
  ) {
    // Remove org=... from URL for grouping
    const urlBase = bm.url.replace(/([?&]org=)[^&]+/, '$1');
    if (!dashboardGroups[urlBase]) dashboardGroups[urlBase] = [];
    dashboardGroups[urlBase].push(bm);
  }
});

// Propagate tags/categories within each group
Object.values(dashboardGroups).forEach(group => {
  let foundCategory = null;
  let foundTags = null;
  group.forEach(bm => {
    if (bm.categoryId) foundCategory = bm.categoryId;
    if (bm.tags && bm.tags.length > 0) foundTags = bm.tags;
  });
  group.forEach(bm => {
    if (!bm.categoryId && foundCategory) bm.categoryId = foundCategory;
    if ((!bm.tags || bm.tags.length === 0) && foundTags) bm.tags = foundTags;
  });
  // If still uncategorized/untagged, assign default
  group.forEach(bm => {
    if (!bm.categoryId) bm.categoryId = 'forethought-dashboard';
    if (!bm.tags || bm.tags.length === 0) bm.tags = ['dashboard'];
  });
});

data.bookmarks = enhancedArr;
fs.writeFileSync(outputPath, JSON.stringify(data, null, 2), 'utf8');
console.log('Enhanced file written to bookmarks_fixed_enhanced.json'); 